function debounce(t,e,i){var n,a,r,s,o,d=function(){var l=Date.now()-s;l<e&&l>=0?n=setTimeout(d,e-l):(n=null,i||(o=t.apply(r,a),n||(r=a=null)))};return function(){r=this,a=arguments,s=Date.now();var l=i&&!n;return n||(n=setTimeout(d,e)),l&&(o=t.apply(r,a),r=a=null),o}}function IntercomWidget(t){this.data=t,this.render=function(){!function(){var e=window,i=e.Intercom;if("function"==typeof i)i("reattach_activator"),i("update",intercomSettings);else{var n=document,a=function(){a.c(arguments)};function r(){var e=n.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://widget.intercom.io/widget/"+t.app_id;var i=n.getElementsByTagName("script")[0];i.parentNode.insertBefore(e,i)}a.q=[],a.c=function(t){a.q.push(t)},e.Intercom=a,e.attachEvent?e.attachEvent("onload",r):e.addEventListener("load",r,!1)}}(),window.Intercom("shutdown"),window.Intercom("boot",this.data)}}function UnderscoredKeysJSON(t){for(k in this.data=t,t){this[k.replace(/([A-Z])/g,"_$1").toLowerCase()]=t[k]}}function plusMinusInputConfigurator(t){$(t).find(".plus-minus-input").each(function(){function t(){a(r()),l.prop("disabled",!1),c.prop("disabled",!1)}function e(t){0==t?o.removeClass("non-zero"):o.addClass("non-zero")}function i(){u.focus(),u.blur()}function n(t){return parseInt(t)||0}function a(t){s(t,function(t){u.val(t),e(t)})}function r(){return parseInt(u.val())||0}function s(t,e){e(t>d?t:d)}var o=$(this),d=n(o.data("min-value")),l=o.find(".btn-plus"),c=o.find(".btn-minus"),u=o.find(".input");l.off().on("click",function(t){t.preventDefault(),a(r()+1),i()}),c.off().on("click",function(t){t.preventDefault(),a(r()-1),i()}),u.on("change",function(t){t.preventDefault(),a(r())}),t()})}function initTooltips(){$('[data-toggle="tooltip"]').tooltip({placement:function(t,e){var i=$(e).offset();return.5*$(document).outerWidth()-i.left>0?"right":"left"}})}function initAddtoCardForm(){$(".add-to-cart-form").each(function(){function t(){var t=a(r.find("input"));n(t)&&e(t,function(t){i(t)})}function e(t,e){$.ajax({type:"PUT",url:"/cart",data:t,success:function(t){e(t)}})}function i(t){s.trigger(o,[t.line_items,t.last_updated_line_item])}function n(t){return t["cart_item[quantity]"]>0}function a(t){var e=Object.create(null),i=function(t){return t.name=$.camelCase(t.name),t},n=function(t,i){var n=e[i.name];e[i.name]=null!=n?n.push?n.push(i.value):[n,i.value]:i.value};return $.each($.map(t.serializeArray(),i),n),e}var r=$(this),s=$(document),o="updatedCartItems";r.on("submit",function(e){e.preventDefault(),t()})})}function CategoryTree(t,e,i,n){function a(t,e){t.forEach(function(t){if(t.children.length>0)var r=new InternalNode(new LeafNode(t,i.clone()));else r=new LeafNode(t,n.clone());r.appendTo(e),r.eachChildren(a)})}function r(t){var e=t.parent().closest(".list-item");e.length>0&&r(e),t.parent().closest(".list").addClass("open"),s(t)}function s(t){t.find(".collapse-indicator").first().removeClass("collapsed").attr("aria-expanded","true"),t.find(".list").first().collapse("show")}this.render=function(){a(t,e),r(e.find(".list-item[data-selected]"))}}function InternalNode(t){this.appendTo=function(e){t.appendTo(e);var i="category-"+t.category.slug.replace("&","-");t.template.find(".categories").attr("id",i),t.template.find("[data-toggle]").attr("href","#"+i),t.template.find(".list .btn-back").text(t.category.name)},this.eachChildren=function(e){t.eachChildren(e)}}function LeafNode(t,e){this.category=t,this.template=e,this.appendTo=function(t){e.find(".node-name").text(this.category.name),e.find(".node-link").attr("href",this.category.url),e.find(".node-count").text("("+this.category.products_count+")"),e.data("current")==this.category.slug&&e.attr("data-selected",1),e.removeAttr("data-current"),e.appendTo(t),e.show()},this.eachChildren=function(t){t(this.category.children,e.find(".categories"))}}function CharacteristicFiltersWidget(t){this.$root=t,this.render=function(){var e=this;this.$root.find(".header").click(function(){$(this).unbind("click"),$(this).removeClass("content-collapsed"),e.$root.find(".loader").show(),e.$root.find(".list-node").each(function(){var e=$(this),i=$(".characteristics_count"),n=$(this).data("api-url");$.get(n).done(function(t){new CharacteristicNodes(i,t,e).render()}).always(function(){t.find(".loader").hide()})})})}}function CharacteristicNode(t,e,i){this.characteristic=t,this.template=e,this.baseUrl=i,this.template.find("a.node-char").text(this.characteristic.name),this.template.find("a.node-char").attr("href","#"+t.id),this.template.find("span.text-fixed").text("("+t.values.length+")"),this.template.find("a.collapse-indicator.collapsed").attr("href","#"+t.id),this.expand=function(){this.template.find(".collapse-indicator").removeClass("collapsed")}}function CharacteristicNodes(t,e,i){this.countTmpl=t,this.characteristics=e,this.root=i,this.render=function(){mainTmpl=i.find(".node-char-template"),valuesTmpl=i.find(".node-values-template"),baseUrl=i.find(".node-values-template").data("base-url"),actives=valuesTmpl.data("actives"),this.countTmpl.text("("+e.length+")"),e.forEach(function(t){if(1!=t.values.length||actives.includes(t.values[0].slug)){var e=new CharacteristicNode(t,mainTmpl.clone(),baseUrl);e.template.appendTo(i),mainTmpl.remove(),new ValuesNode(t.values,t.id,valuesTmpl.clone(),e).appendTo(i),valuesTmpl.remove()}}),e.length>0&&i.show()}}function ValueNode(t,e,i,n,a){this.value=t,this.valuesNode=e,this.template=i,this.actives=n,this.base_url=a,this.checkbox=null,this.appendTo=function(e){this.checkbox=this.template.find('input[type="checkbox"]'),i.appendTo(e);var n=t.slug.replace("&","-");i.find(".characteristic_value").attr("id",n).attr("name",t.name),i.find(".col-sm-1").find("label").attr("for",t.slug),i.find(".filter-label").attr("for",t.slug).text(t.name),this.handleClick()},t.slug,n.includes(t.slug)&&(this.template.find('input[type="checkbox"]').attr("checked",!0),this.valuesNode.expand()),this.goToUrl=function(){var t=this.base_url;this.checkbox.is(":checked")?n.includes(this.value.slug)||n.push(this.value.slug):n.splice(n.indexOf(this.value.slug),1),n.forEach(function(e){suffix=t.match(/\?/)?"&":"?",t+=suffix+"characteristics[]="+e}),window.location=t},this.handleClick=function(){var t=this;i.find(".characteristic_value").click(function(){t.goToUrl()})}}function ValuesNode(t,e,i,n){this.values=t,this.template=i,this.parentNode=n,this.characteristicId=e,this.appendTo=function(e){var n=i.find(".node-value-template");this.template.attr("id",this.characteristicId);var a=this;t.forEach(function(t){new ValueNode(t,a,n.clone(),i.data("actives"),i.data("base-url")).appendTo(i.find("form.form")),n.remove()}),i.appendTo(e)},this.expand=function(){this.parentNode.expand(),this.template.addClass("in")}}function CrossSellingCard(t){this.card_data=t,this.renderOn=function(t){t.attr("data-brand_name",this.card_data.brand_name),t.attr("data-category_name",this.card_data.category_name),t.attr("data-sku",this.card_data.sku),t.find(".link-area").attr("href","/products/"+this.card_data.sku),t.find(".img-wrapper").find("img").attr("src",this.card_data.image_path).attr("alt",this.card_data.sku),t.find(".title.sku").text(this._truncate(this.card_data.sku)),t.find(".additional.hidden-sm-down").attr("data-original-title",this.card_data.description),t.find(".additional.hidden-sm-down").text(this.card_data.description),t.find(".additional.hidden-sm-up").text(this.card_data.description),t.find(".cart_item").attr("value",this.card_data.id)},this._truncate=function(t,e=16,i="..."){return t.length>e?t.substring(0,e-i.length)+i:t}}function ProductCards(){this.cards=[],this.add=function(t){return this.cards.push(t),this},this.renderOn=function(t){var e=t.find(".cards-list"),i=t.find(".card-item");this.cards.forEach(function(t){var n=i.clone();t.renderOn(n),e.append(n)}),t.length<1||(i.remove(),plusMinusInputConfigurator(document),initAddtoCardForm(),initTooltips(),t.show())}}function RemoteCrossSellings(t){this.apiURL=t,this.forEach=function(t){$.get(this.apiURL,function(e){e.forEach(function(e,i,n){t(new CrossSellingCard(e),i,n)})})}}var Kyklo;!function(t,e){function i(t,i,n,a,r){function s(){p(),l(),c()}function o(){u(),a&&a()}function d(){u(),r&&r()}function l(){f().find(".btn-agree").on("click",e.proxy(o,this)),f().find(".btn-disagree").on("click",e.proxy(d,this)),f().on("hidden.bs.modal",e.proxy(h,this))}function c(){f().modal("show")}function u(){f().modal("hide")}function h(){f().remove()}function f(){return e("."+i)}function p(){e("body").append(m($)({message:t,modalClass:i}))}function m(t){return function(i){var n=t;return e.each(i,function(t,e){n=n.replace(new RegExp("{{"+t+"}}","g"),e)}),n}}var $=e(n).html();s()}t.confirmationModal=function(t,e,n){i(t,"modal-confirmation",".confirmation-modal-template",e,n)},t.alertModal=function(t,e){i(t,"modal-alert",".alert-modal-template",e)}}(window,$),$(".btn-dropdown-clickable").each(function(){function t(t){a(t)||e()}function e(){r.removeClass("open"),n(),s.unbind("click",t)}function i(){s.on("click",$.proxy(t,this))}function n(){s.unbind("click",t)}function a(t){return $(t.target).parents(r).is(r)}var r=$(this),s=$(document);r.on("shown.bs.dropdown",function(){i()}),r.on("hide.bs.dropdown",function(t){t.preventDefault()})}),I18n.defaultLocale=$("body").data("default-locale"),I18n.locale=$("body").data("locale"),$(".modal-with-video").each(function(){function t(){e()}function e(){a.on("shown.bs.modal",function(){i()}),a.on("hidden.bs.modal",function(){n()})}function i(){var t=r.data("src");r.attr("src",t)}function n(){r.attr("src",null)}var a=$(this),r=a.find(".video");t()}),$(document).ready(function(){$(".typeahead").each(function(){function t(){d.typeahead({hint:!1,minLength:2,highlight:!0,classNames:{dataset:f}},{display:p?"---":null,source:debounce(i,500),templates:{suggestion:e(c)}}),n(),a(),p&&r()}function e(t){return function(e){return e.volume_prices&&(e.volume_prices=JSON.stringify(e.volume_prices)),Mustache.render(t,e)}}function i(t,e,i){return $.get(h,{search:t},function(t){return i(t)})}function n(){d.bind("typeahead:close typeahead:open",function(){o.toggleClass("active")})}function a(){d.bind("typeahead:asyncrequest typeahead:asynccancel typeahead:asyncreceive",function(){o.toggleClass("loading")})}function r(){d.unbind("blur.tt"),o.find(u).unbind(),s()}function s(){l.on("click.tt",function(){d.typeahead("close")})}var o=$(this),d=o.find(".input"),l=$(".overlay"),c=o.find(".item-template").html(),u=".tt-menu",h=o.data("url"),f=o.data("wrapper-class"),p=o.data("clickable");t()})}),$(".alerts").each(function(){$(this).delay(3e3).fadeOut("slow")}),(Kyklo=Kyklo||{}).Dropdown=Kyklo.Dropdown||{},Kyklo.Dropdown.BuyersFromCompanyFetcher=function(t,e,i){Subscribable.call(Kyklo.Dropdown.BuyersFromCompanyFetcher.prototype),this.url=t,self=this,this.listItemClicked=function(t,e){self._refreshList(e)},this.init=function(){self._refreshList(i.getSelectedID())},this._refreshList=function(i){if(e.originalList.clearList(),e.originalList.add(0,"please select buyer"),null!=i){var n=t.replace(":company_id",i);$.get(n,function(t){t.forEach(function(t){e.originalList.add(t.id,t.name)});var i=e.list.$template.find("li:first").clone();e.list.clearList(),e.originalList.eachItem(function(t){var n=new Kyklo.Dropdown.DefaultItem(t,i.clone()).subscribe(e);e.list.add(n)})})}}},(Kyklo=Kyklo||{}).Dropdown=Kyklo.Dropdown||{},Kyklo.Dropdown.Factory=function(){this.html_template="     <div class='kyklo-dropdown-template'>       <div class='box' type='button'>         <input type='text' value='' placeholder=''/>         <span class='arrow-down'></span>         </div>       <div class='list-wrapper list-wrapper-down'>         <ul class='list'>           <li tabindex='1' id='0'><span class='item'></li>         </ul>       </div>     </div>",this.$template=$(this.html_template),this.build=function(){var e={},i=this;return $(".kyklo-dropdown-wrapper").each(function(){var n,a,r=this,s=i.$template.clone(),o=$(this).find(".kyklo-dropdown").data("plugins")==undefined?[]:$(this).find(".kyklo-dropdown").data("plugins").split(","),d=new Kyklo.Dropdown.OriginalList($(this).find(".kyklo-dropdown"));0==o.length?(n=new Kyklo.Dropdown.DefaultList(s,$(this).width()),a=t(d,n,i.$template)):$.each(o,function(e,o){switch(o){case"tree":n=new Kyklo.Dropdown.TreeList(s,$(r).width()),a=t(d,n,i.$template)}}),e[$(r).attr("id")]=a,n.render(),a.renderOn(this)}),e};var t=function(t,e,i){var n=new Kyklo.Dropdown.Widget(t,e);return t.eachItem(function(t){var a=new Kyklo.Dropdown.DefaultItem(t,i.find("li").clone()).subscribe(n);e.add(a)}),n}},(Kyklo=Kyklo||{}).Dropdown=Kyklo.Dropdown||{},Kyklo.Dropdown.DefaultItem=function(t,e){Subscribable.call(Kyklo.Dropdown.DefaultItem.prototype),this.$template=e,this.$option=t,this.builded=!1,this.appendTo=function(t){return this._build(),t.append(this.$template),this},this._build=function(){if(this.builded)return this;this._building_template(),this.builded=!0;var t=this;return this.$template.on("click",$.proxy(function(){this._publish("listItemClicked",[t.$option.text(),t.$option.val()])},this)),this},this._building_template=function(){this.$template.find(".item").text(this.$option.text()),this.$template.find(".item").val(this.$option.val())}},(Kyklo=Kyklo||{}).Dropdown=Kyklo.Dropdown||{},Kyklo.Dropdown.DefaultList=function(t,e){Subscribable.call(Kyklo.Dropdown.DefaultList.prototype),this.$template=t,this.width=e,this.items=[];var i=this;$(document).on("click",$.proxy(function(t){t.target!=i.$template.find("input")[0]&&i._publish("outsideboxClicked")},i)),this.render=function(){var t=this.width-parseInt(this.$template.width());return this.$template.find(".list").find("li:first").remove(),this.$template.find(".list").css("width",t),this},this.filterItems=function(t){this._resetFilters(),t.length>2&&(this.$template.find("li").each(function(){-1==$(this).text().search(new RegExp(t,"i"))&&$(this).hide()}),0==this.$template.find("li:visible").length&&this._buildNoResult()),this.$template.find(".list-wrapper").show()},this.toggle=function(){this._adjustHeigth(),this.$template.find(".list-wrapper").toggle()},this.hide=function(){this.$template.find(".list-wrapper").hide()},this.add=function(t){this.items.push(t),t.appendTo(this.$template.find(".list"))},this.clearList=function(){$list=t.find(".list"),$list.children().remove()},this._adjustHeigth=function(){$list=t.find(".list");var e=$(window).height()-(this.$template.offset().top-$(window).scrollTop())-this.$template.height()-10;$list.css("max-height",e)},this._resetFilters=function(){this.$template.find("li").each(function(){$(this).show(),"No result found"==$(this).text()&&$(this).remove()})},this._buildNoResult=function(){var e=this.$template.find("li:first").clone();e.text("No result found"),e.show(),t.find(".list").prepend(e)}},(Kyklo=Kyklo||{}).Dropdown=Kyklo.Dropdown||{},Kyklo.Dropdown.TreeList=function(t,e){Subscribable.call(Kyklo.Dropdown.TreeList.prototype),this.$template=t,this.width=e,this._list=[],this._$newListTag=$("<ul class='sub-list'>"),this.visible_ids=[];var i=this;$(document).on("click",$.proxy(function(t){t.target!=i.$template.find("input")[0]&&i._publish("outsideboxClicked")},i)),this.render=function(){var e=this.width-parseInt(this.$template.width());return this.$template.find(".list").css("width",e),$options=t.find("options"),this._buildChildrenRecursively(0,this._$newListTag.clone()).appendTo(this.$template.find(".list")),this.$template.find(".list").find("li:first").remove(),this},this.filterItems=function(t){this._resetFilters(),self=this,t.length>2&&(this.$template.find("li").each(function(){$(this).text().search(new RegExp(t,"i"))>-1?(self.visible_ids.push($(this).attr("id")),self._visibleRecrusive($(this).attr("parent-id"))):$(this).hide()}),$.each(this.visible_ids,function(){self.$template.find("#"+this).show()}),0==this.$template.find("li:visible").length&&this._buildNoResult()),this.$template.find(".list-wrapper").show()},this.toggle=function(){this._adjustHeigth(),this.$template.find(".list-wrapper").toggle()},this.hide=function(){this.$template.find(".list-wrapper").hide()},this._adjustHeigth=function(){$list=t.find(".list");var e=$(window).height()-(this.$template.offset().top-$(window).scrollTop())-this.$template.height()-10;$list.css("max-height",e)},this.add=function(t){this._list.push(t)},this._buildChildrenRecursively=function(t,e){return self=this,$.each(this._list,function(){if(this.$option.data("parent-id")==t){var i=self._$newListTag.clone();this.appendTo(i),this.$option.val()&&self._buildChildrenRecursively(this.$option.val(),i),i.appendTo(e)}}),e},this._resetFilters=function(){this.$template.find("li:hidden").parent().show(),this.visible_ids=[],this.$template.find("li").each(function(){$(this).show(),"No result found"==$(this).text()&&$(this).remove()})},this._buildNoResult=function(){var e=this.$template.find("li:first").clone();e.text("No result found"),e.show(),t.find(".list").prepend(e)},this._visibleRecrusive=function(t){self=this,this.$template.find("li").each(function(){$(this).attr("id")==t&&(self.visible_ids.push($(this).attr("id")),self._visibleRecrusive($(this).attr("parent-id")))})}},(Kyklo=Kyklo||{}).Dropdown=Kyklo.Dropdown||{},Kyklo.Dropdown.OriginalList=function(t){Subscribable.call(Kyklo.Dropdown.OriginalList.prototype),this.$template=t,this.select=function(t){this.$template.val(t).change()},this.eachItem=function(t){this.$template.find("option").each(function(e,i){t($(i))})},this.add=function(t,e){var i=$("<option>");i.text(e),i.val(t),this.$template.append(i)},this.clearList=function(){this.$template.find("option").remove()}},(Kyklo=Kyklo||{}).Dropdown=Kyklo.Dropdown||{},Kyklo.Dropdown.SearchBox=function(t,e,i){Subscribable.call(Kyklo.Dropdown.SearchBox.prototype),this.$template=t,this.placeholder=e,this.disabled=i,this.$template.on("click",$.proxy(function(){"disabled"!=i&&this._publish("boxClicked")},this)),this.$template.find("input").attr("placeholder",this.placeholder),"disabled"==i&&(this.$template.find("input").attr("disabled",!0),this.$template.find("input").addClass("disabled"),this.$template.addClass("disabled")),this.refresh=function(t){this.$template.find("input").val(t)},this.$template.on("keyup",$.proxy(function(){this._publish("inputCharacterAdded",[this.$template.find("input").val()])},this))},Kyklo.Dropdown=Kyklo.Dropdown||{},Kyklo.Dropdown.Widget=function(t,e){this.originalList=t,this.list=e,this.renderOn=function(t){this.list.$template.appendTo(t)};var i=new Kyklo.Dropdown.SearchBox(this.list.$template.find(".box"),t.$template.find(":selected").text(),t.$template.attr("disabled"));i.subscribe(this),this.list.subscribe(this),this.listItemClicked=function(n,a){e.toggle(),t.select(a),i.refresh(n)},this.boxClicked=function(){e.toggle()},this.outsideboxClicked=function(){e.hide()},this.inputCharacterAdded=function(t){e.filterItems(t)},this.getSelectedID=function(){return result=t.$template.find(":selected").attr("value"),result==undefined?null:result}},$(document).ready(function(){$(".intercom").each(function(){new IntercomWidget(new UnderscoredKeysJSON($(this).data())).render()})}),Subscribable=function(){this.subscribe=function(t){return this._initObservers(),this._observers.push(t),this},this._notify=function(t,e){for(var i in this._initObservers(),this._observers)this._observers[i][t].apply(this._observers[i],e)},this._publish=function(t,e){for(var i in this._initObservers(),this._observers)this._observers[i][t].apply(this,e)},this._initObservers=function(){this._observers==undefined&&(this._observers=[])}},(Kyklo=Kyklo||{}).MessageBroker=class{constructor(){this.routing={}}register(t,e){return e.forEach(function(e){this.routing[e]==undefined&&(this.routing[e]=[]),this.routing[e].push(t)}.bind(this)),this}dispatch(t){let e=this.routing[t.name];return e.length>0&&e.forEach(function(e){e.receive(t)}),this}},(Kyklo=Kyklo||{}).Pricing=Kyklo.Pricing||{},Kyklo.Pricing.VolumeDiscountsForm=class extends Subscribable{constructor(t){super(),this.$form=t,this.$errors=this.$form.find(".errors"),this.$submitButton=this.$form.find('input[name="commit"]')}init(){return this._bindEvents(),this}render(t){t.ppg_setting_id&&this._changeMethodToPatch(),this.$form.find('input[name="advanced_pricing[id]"]').val(t.ppg_setting_id),this.$form.find('input[name="advanced_pricing[company_type_id]"]').val(t.company_type_id),this.$form.find('input[name="advanced_pricing[product_pricing_group_id]"]').val(t.ppg_id)}addRow(t){let e=this.$form.find(".volume-discounts");return t.appendTo(e),this}_changeMethodToPatch(){this.$form.attr("method","patch"),this.$form.find('input[name="_method"]').val("patch")}_disableSubmitButton(){this.$submitButton.prop("disabled",!0),this.$submitButton.val("Please wait...")}_enableSubmitButton(){this.$submitButton.prop("disabled",!1),this.$submitButton.val("Update")}_showErrors(t){t&&t.errors?$.each(t.errors.discounts,(t,e)=>{$.each(e,(e,i)=>{let n=this.$form.find(`input[name="advanced_pricing[discounts][][${e}]"]:not(:disabled):eq(${t})`);n.next(".error-messages").text(i).show(),n.wrap('<div class="field_with_errors"></div>')})}):this.$errors.text("Some of your inputs have errors").show()}_clearErrors(){this.$errors.hide(),this.$errors.empty(),this.$form.find(".field_with_errors").children().unwrap(),this.$form.find(".error-messages").hide()}_bindEvents(){this.$form.submit(t=>{t.preventDefault(),this._disableSubmitButton(),this._clearErrors(),$.ajax({method:this.$form.attr("method"),url:this.$form.attr("action"),data:this.$form.serialize(),success:t=>{let e=t&&t.id,i=this.$form.find('input[name="advanced_pricing[product_pricing_group_id]"]').val(),n=this.$form.find('input[name="advanced_pricing[company_type_id]"]').val(),a=this.$form.find(".volume-discounts .volume-discount input:not(:disabled)");this._notify("volumeDiscountsUpdated",[i,n,a,e])},error:t=>{this._showErrors(t.responseJSON),this._enableSubmitButton()}})})}},(Kyklo=Kyklo||{}).Pricing=Kyklo.Pricing||{},Kyklo.Pricing.VolumeDiscountRow=class{constructor(t){this.$template=t,this.$volumeField=this.$template.find('input[name="advanced_pricing[discounts][][volume]"]'),this.$percentageField=this.$template.find('input[name="advanced_pricing[discounts][][percentage]"]'),this.$removeButton=this.$template.find(".remove-volume-discount")}render(t){1==t.volume&&(this.$volumeField.prop("readonly",!0),this.$removeButton.prop("hidden",!0)),this._setVolume(t.volume),this._setPercentage(t.percentage),this.$template.prop("hidden",!1)}appendTo(t){t.append(this.$template)}disable(){return this.$volumeField.prop("disabled",!0),this.$percentageField.prop("disabled",!0),this.$removeButton.prop("hidden",!0),this}"delete"(){return this.$template.remove(),this}_setVolume(t){this.$volumeField.prop("disabled",!1),this.$volumeField.val(t)}_setPercentage(t){this.$percentageField.prop("disabled",!1),this.$percentageField.val(t)}},(Kyklo=Kyklo||{}).Pricing=Kyklo.Pricing||{},Kyklo.Pricing.Advanced=Kyklo.Pricing.Advanced||{},Kyklo.Pricing.Advanced.MatrixItem=class{constructor(t){this.template=$(t)}set(t){return this.template.val(t),this}highlight(){this.template.finish().removeClass("non-highlighted").addClass("highlight").delay(6e3).queue(()=>{this.template.removeClass("highlight").addClass("non-highlighted").dequeue()})}},(Kyklo=Kyklo||{}).RemoteCollection=class{constructor(t){this.url=t,this.items=null}forEach(t){return this.items?this.items.forEach(e=>{t(e)}):this.fetchItems(()=>{this.forEach(t)}),this}fetchItems(t){return $.get(this.url).done(e=>{this.items=e,t()}),this}},(Kyklo=Kyklo||{}).USAStates=function(t,e){this.$countrySelect=t,this.$stateSelect=e,this.$stateFormGroup=this.$stateSelect.parents(".form-group"),this._isoCode="US",this.init=function(){this.$countrySelect.change($.proxy(function(){this._refreshStates()},this)),this._refreshStates()},this._refreshStates=function(){this._countrySelectedHasIsoCode(this._isoCode)?this._enableStatesSelect():this._disableStatesSelect()},this._countrySelectedHasIsoCode=function(t){return this.$countrySelect.find(":selected").data("iso-code")==t},this._enableStatesSelect=function(){this.$stateFormGroup.addClass("required"),this.$stateSelect.attr("disabled",!1),this._refreshSelectPicker()},this._disableStatesSelect=function(){this.$stateFormGroup.removeClass("required"),this.$stateSelect.attr("disabled",!0),this._hideStatesErrors(),this._refreshSelectPicker()},this._refreshSelectPicker=function(){$(".selectpicker").selectpicker("refresh")},this._hideStatesErrors=function(){$fieldWithErrors=this.$stateFormGroup.find(".field_with_errors"),$fieldWithErrors.removeClass("field_with_errors"),$stateErrorMessages=this.$stateFormGroup.find(".error-messages"),$stateErrorMessages.hide()}},plusMinusInputConfigurator(document),initTooltips(),initAddtoCardForm(),$(".address-form").each(function(){new Kyklo.USAStates($(this).find('[name="address[country_id]"]'),$(this).find('[name="address[state]"]')).init()}),$(document).ready(function(){let t=$(".sidemenu-filters.brand-filters");if(0==t.length)return;let e=$(".dropdown-menu.brand-filters"),i=e.find(".dropdown-item");if(0==t.length&&0==e.length)return;e.length>0&&i.remove(),t.length>0&&t.find(".loader").hide();let n=$(".sidemenu-filters.brand-filters").data("api-url");new Kyklo.RemoteCollection(n).forEach(n=>{t.length>0&&new Kyklo.Branding.Filter(n).attachTo(t);if(e.length>0){var a=i.clone(),r="/brands/"+n.slug;a.html(n.name).attr("href",r),e.append(a)}})}),$(".cart-item-added-side-alert").each(function(){function t(t){r.text(t)}function e(){a.addClass("in")}function i(){a.removeClass("in")}function n(t){setTimeout(i,t)}var a=$(this),r=a.find(".side-alert-content"),s="updatedCartItems";$(document).on(s,function(i,a,r){t(r.sku),e(),n(3e3)}),a.on("close.bs.alert",function(){return i(),!1})}),$(".cart-items-counter").each(function(){function t(t){e.text(t)}var e=$(this),i="updatedCartItems";$(document).on(i,function(e,i){t(i.length)})}),$(".tree-root").each(function(){var t=$(this),e=$(".internal-node-template").removeClass("internal-node-template"),i=$(".leaf-node-template").removeClass("leaf-node-template"),n=$(this).find(".loader");$.ajax({url:t.data("url"),success:function(n){new CategoryTree(n,t,e,i).render(),e.remove(),i.remove(),t.show()},complete:function(){n.hide()}})}),$(document).ready(function(){new CharacteristicFiltersWidget($(".characteristics-filters")).render()}),$(document).ready(function(){var t=$("form[data-clone-order-form]"),e=$("input[data-clone-order-button]"),i=e.attr("data-message");e.click(function(e){e.preventDefault(),confirmationModal(i,function(){t.submit()},null)})}),$(document).ready(function(){$(".cross-selling").each(function(){$(window).on("scroll",function(){$(window).off("scroll");var t=new RemoteCrossSellings($(".cross-selling").data("url")),e=$(".cross-selling"),i=new ProductCards;t.forEach(function(t,n,a){i.add(t),n+1==a.length&&i.renderOn(e)})})})}),$(".expandable-panel").each(function(){var t=$(this),e=t.find(".content"),i=t.find(".toggle-expand-button");e.height()<parseInt(e.css("max-height"))&&i.hide(),i.on("click",function(e){e.preventDefault(),t.hasClass("collapsed")?(t.removeClass("collapsed").addClass("expanded"),$(e.target).text(I18n.t("storefront.show_less"))):(t.removeClass("expanded").addClass("collapsed"),$(e.target).text(I18n.t("storefront.show_all")))})}),$(".form-order").each(function(){function t(){var t=window.orderInitialData,e=window.orderInitialData.line_items;I.addInitialOrderData(t),I.addInitialProducts(e)}function e(t,e){e.toggleClass("row-added"),t.text(t.data("clicked-text")).attr("onclick",null)}function i(){n(),a(),r(),plusMinusInputConfigurator(M),s()}function n(){M.empty(),$.each(I.itemsList,function(t,e){M.prepend(k(O)(o(e,I.productFieldsViewFormatting)))})}function a(){P.empty(),P.prepend(k(B)(o(I.order,I.orderFieldsViewFormatting)))}function r(){$(".selectpicker").selectpicker("refresh")}function s(){S.trigger(T,[I.itemsList])}function o(t,e){var i=$.extend({},t);return $.each(t,function(t,n){var a=e[t];a&&(n=a(n)),i[t]=n}),i}function d(t){return x(t.find("input"))}function l(t){return t.data("confirmation-text")}function c(t){return g(d(t))}function u(){var t={final_price:0,is_price_set:!0,is_empty:!0,custom_discount:I.order.custom_discount};t.is_empty=0==I.itemsList.length,$.each(I.itemsList,function(e,i){i.is_price_set?t.final_price+=i.final_price:t.is_price_set=!1});var e=t.final_price-t.custom_discount+I.order.shipment_cost,i=e+e*I.order.tax/100;t.final_price_included_discount=i<=0?0:C(i),$.extend(I.order,t)}function h(t){var e=f(t);return E.trigger(F,[t,t.quantity]),e?t.quantity+=e.quantity:I.itemsList.push(t),u(),w(t.product_id,{quantity:t.quantity})}function f(t){return $.grep(I.itemsList,function(e){return t.product_id==e.product_id})[0]}function p(t){var e;for(var i in I.itemsList)if((e=I.itemsList[i]).product_id===t){I.itemsList.splice(i,1),E.trigger(L,[e,e.quantity]);break}return u(),b(t)}function m(t,e){var i,n;for(var a in I.itemsList)if((i=I.itemsList[a]).product_id===t){(n=e.quantity-i.quantity)>0?E.trigger(F,[i,n]):n<0&&E.trigger(L,[i,-n]),$.extend(i,e);break}u()}function v(t){return $.extend(I.order,t),y(t)}function g(t){var e={};return e.product_id=t.product_id,e.sku=t.sku,e.description=t.description,e.brand_name=t.brand_name,e.currency_code=t.currency_code,e.image_url=t.image_url,e.category_name=t.category_name,e.in_stock=!0===t.in_stock||"true"===t.in_stock,e.is_price_set=!0===t.is_price_set||"true"===t.is_price_set,e.is_price_fixed=!0===t.is_price_fixed||"true"===t.is_price_fixed,e.has_discount=!!(t.discount&&Number(t.discount)>0),e.price=Math.abs(parseFloat(t.price)),e.price_formatted=t.price_formatted,e.discount=Math.abs(parseFloat(t.discount)),e.net_price=Math.abs(parseFloat(t.net_price)),e.net_price_formatted=t.net_price_formatted,e.quantity=Math.abs(parseInt(t.quantity)),e.final_price_formatted=t.final_price_formatted,t.final_price?e.final_price=e.quantity*e.net_price:e.final_price=Math.abs(parseFloat(t.final_price)),e}function _(t){var e={};return e.final_price=Math.abs(parseFloat(t.final_price)||0),e.currency_code=t.currency_code,e.remarks=t.remarks,e.is_price_set=!0,e.final_price=Math.abs(parseFloat(t.final_price)),e.final_price_formatted=t.final_price_formatted,e.shipment_cost=Math.abs(parseFloat(t.shipment_cost)),e.tax=Math.abs(parseFloat(t.tax)),e.custom_discount=Math.abs(parseFloat(t.custom_discount)),e}function b(t){return w(t,{quantity:0})}function y(t){return $.ajax({type:"PUT",url:N,data:{cart:t}})}function w(t,e){var i=$.extend({},e,{product_id:t});return $.ajax({type:"PUT",url:N,data:{cart_item:i}})}function k(t){return function(e){return Mustache.render(t,e)}}function x(t){var e=Object.create(null),i=function(t){return t.name=$.camelCase(t.name),t},n=function(t,i){var n=e[i.name];e[i.name]=null!=n?n.push?n.push(i.value):[n,i.value]:i.value};return $.each($.map(t.serializeArray(),i),n),e}function C(t){var e=t%1==0?0:2;return Number(t).toFixed(e).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")}function K(t){if(!t||0==t)return null;var e=t%1==0?0:2;return Number(t).toFixed(e).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")}function D(t){return t&&0!=t?(100*Number(t)).toFixed(2)+"%":null}var I=this,S=$(document),T="updatedCartItems",F="addedToCart",L="removedFromCart";I.itemsList=[],I.order={},I.orderFieldsViewFormatting={final_price:function(t){return C(t)}},I.productFieldsViewFormatting={price:function(t){return K(t)},discount:function(t){return D(t)},net_price:function(t){return C(t)},final_price:function(t){return C(t)}};var E=$(I),N=E.data("update-order-url"),P=E.find(".form-order-order-summary"),B=$(".form-order-order-summary-template").html(),M=E.find(".form-order-item-list"),O=$(".form-order-item-template").html();I.addInitialProducts=function(t){I.itemsList=[],$.each(t,function(t,e){I.itemsList.push(g(e))}),u(),i()},I.addInitialOrderData=function(t){I.order={};var e=_(t);$.extend(I.order,e),i()},I.addProductButtonClicked=function(t,n){e($(t),n),h(c(n)).done(function(t){I.addInitialOrderData(t),I.addInitialProducts(t.line_items)}),i()},I.removeProductButtonClicked=function(t,e){var i=$(t);confirmationModal(l(i),function(){p(e).done(function(t){I.addInitialOrderData(t),I.addInitialProducts(t.line_items)})})},I.remarksChanged=function(t){v({remarks:$(t).val()})};var q=null;I.productQuantityPickerValueChanged=function(t,e){var n=parseInt($(t).val());m(e,{quantity:n}),i(),clearTimeout(q),q=setTimeout(function(){var i=parseInt($(t).val());w(e,{quantity:i}).done(function(t){I.addInitialOrderData(t),I.addInitialProducts(t.line_items)})},500)},t()}),$(document).ready(function(){function t(t){$(t).on("click",function(t){function e(){window.location=i.attr("href")}var i=$(this),n=a(i);if(0!==n.length){var o=n.data(),d=r(n);t.preventDefault(),s(o,d,e),setTimeout(e,c)}})}function e(t){$(t).on("submit",function(){function t(){var t=e.serializeArray();for(var i in t){var n=t[i];if("cart_item[quantity]"===n.name)return parseInt(n.value,10)}}var e=$(this),i=a(e);if(0!==i.length){var n=t();if(n)o("add",i.data(),n)}})}function i(t){$(t).on("addedToCart removedFromCart",function(t,e,i){o("addedToCart"===t.type?"add":"remove",e,i)})}function n(t){$(t).on("submit",function(t){function e(){i.submit()}var i=$(this);if(!i.data("submitted")){var n=i.find('input[name="search"]').val().trim();i.data("submitted",!0),t.preventDefault(),d(n,e),setTimeout(e,c)}})}function a(t){return t.closest("[data-sku]")}function r(t){return t.closest("[data-analytics-list-name]").data("analytics-list-name")||null}function s(t,e,i){ga("ec:addProduct",l(t)),ga("ec:setAction","click",{list:e}),ga("send","event","UX","click",e,{hitCallback:i})}function o(t,e,i){var n=l(e);n.quantity=i,ga("ec:addProduct",n),ga("ec:setAction",t),ga("send","event","Cart",t)}function d(t,e){ga("send","event","UX","search",t,{hitCallback:e})}function l(t){return{id:t.sku,brand:t.brand_name,category:t.category_name,position:t.rank,price:parseFloat(t.net_price)}}if(window.ga){var c=1e3;t('a[href^="/products/"]'),e(".add-to-cart-form"),i(".form-order"),n(".search form")}}),$(".brand-list-filter").each(function(){function t(t){r.filter("input[value="+t+"]").prop("checked",!0)}function e(t){var e=["categories","brands"],i={},n=t.split("/");return n.forEach(function(t,a){-1!=$.inArray(t,e)&&n[a+1]&&(i[t]=n[a+1].split("--"))}),i}function i(t){return $.map(t,function(t,e){return t!==undefined&&0!=t.length?e+"/"+t.join("--"):null}).join("/")+window.location.search}function n(){var t,e=[];a.find("input:checked").each(function(){e.push($(this).val())}),s.brands=e,t=i(s),$(location).attr("href","/"+t)}var a=$(this),r=a.find(":checkbox"),s=e($(location).attr("pathname"));(s.brands||[]).forEach(t),r.change(n)}),$(".sign-up-form").each(function(){function t(t){t?$address.show():$address.hide()}function e(){inputs=$address.find("input"),$address.find(".field_with_errors").removeClass("field_with_errors"),$address.find(".error-messages").removeClass("error-messages").html(""),inputs.val("")}$checkbox=$("#buyer_form_use_delivery_address_for_billing"),$address=$(".billing-address"),new Kyklo.USAStates($(this).find('[name="buyer_form[addresses_attributes][0][country_id]"]'),$(this).find('[name="buyer_form[addresses_attributes][0][state]"]')).init(),t(!$checkbox.is(":checked")),$checkbox.change(function(){checked=$(this).is(":checked"),t(!checked),e()})}),$(".stripe").each(function(){function t(t){var e=document.getElementById("payment-form"),i=document.createElement("input");i.setAttribute("type","hidden"),i.setAttribute("name","stripe_token"),i.setAttribute("value",t.id),e.appendChild(i),e.submit()}var e=$(this).data("publishable-key"),i=Stripe(e),n={base:{color:"#32325d",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#aab7c4"}},invalid:{color:"#fa755a",iconColor:"#fa755a"}},a=i.elements().create("card",{style:n});a.mount("#card-element"),a.addEventListener("change",function(t){var e=document.getElementById("card-errors");t.error?e.textContent=t.error.message:e.textContent=""}),document.getElementById("payment-form").addEventListener("submit",function(e){e.preventDefault(),i.createToken(a).then(function(e){e.error?document.getElementById("card-errors").textContent="Invalid information":t(e.token)})})}),(Kyklo=Kyklo||{}).Branding=Kyklo.Branding||{},Kyklo.Branding.Filter=class{constructor(t){this.brand=t}attachTo(t){let e=t.find(".template").clone().removeClass("template hidden").remove();t.find("form").append(e),e.find("input").attr("id","brand_"+this.brand.id).attr("name","brand_"+this.brand.id).attr("value",this.brand.name).attr("checked",this.brand.slug==t.data("selected-brand")?"checked":null),e.find("label").attr("for","brand_"+this.brand.id),e.find(".filter-label").attr("for","brand_"+this.brand.id).html(this.brand.name);let i=window.location.href,n="/brands/"+this.brand.slug,a=null;if(i.match(n))a=i.replace(n,"");else if(i.match(/brands\/.+/)){var r=i.match(/\/brands\/(.+)/)[1].split("/")[0];a=i.replace("/brands/"+r,n)}else{var s=i.split("?"),o=n+window.location.pathname;a=[o,s[1]].filter(t=>t).join("?")}return a=a.replace("/products",""),e.one("click",function(){window.location.href=a}),this}};